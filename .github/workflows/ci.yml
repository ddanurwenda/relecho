name: build
on:
  push:
    branches:
      - master
    tags:
      - '!*' # Do not execute on tags
jobs:
  coverage:
    runs-on: ubuntu-latest
    steps:
    - name: Install Go
      if: success()
      uses: actions/setup-go@v2
      with:
        go-version: 1.15.x
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Calc coverage
      run: |
        go test -v -covermode=count -coverprofile=cover.out ./...
    - name: Report to CodeClimate
      uses: paambaati/codeclimate-action@v2.7.4
      env:
        CC_TEST_REPORTER_ID: d39be4a39c29db7e92d36b84dd0abd5fdc122da07eb8ad4e7fea3ed8eeff83d0